<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Dashboard</title>
</head>
<body>
    <div class="sidebar">
        <div class="menu"></div>
            <div class="rowhome">
                <span class="material-symbols-outlined">
                    home
                </span>
                <p>Device Managenment</p>
            </div>
            <div class="rowmenu">
                <span class="material-symbols-outlined">
                    dataset_linked
                </span>
                <a href="dashboard.html" style="color: #2783ec;">Dashboard</a>
            </div>
            <div class="rowmenu">
                <span class="material-symbols-outlined">
                    device_reset
                </span>
                <a>Logs</a>
            </div>
            <div class="rowmenu">
                <span class="material-symbols-outlined">
                    settings
                </span>
                <a>Settings</a>
            </div>
    </div>
    <div class="mainDashboard">
        <div class="header">
            <div class="account">
                <span class="material-symbols-outlined">
                    person
                </span>
                <p> Welcome John</p>
            </div>
        </div>
        <div class="dashboard">
            <div class="table">
                <table id="viewDevice">
                    <tr>
                      <th>Device</th>
                      <th>MAC Adress</th>
                      <th>IP</th>
                      <th>Create Date</th>
                      <th>Power Consumption(kW/h)</th>
                    </tr>
                    <tr>
                        <td>TV</td>
                        <td>00:1B:44:11:3A:B7</td>
                        <td>127.0.0.2</td>
                        <td>2021-05-31</td>
                        <td>50</td>
                    </tr>
                    <tr>
                        <td>Washer</td>
                        <td>00:1B:44:11:3A:B8</td>
                        <td>127.0.0.3</td>
                        <td>2021-05-31</td>
                        <td>60</td>
                    </tr>
                    <tr>
                        <td>Refrigerator</td>
                        <td>00:1B:44:11:3A:B9</td>
                        <td>127.0.0.4</td>
                        <td>2021-05-31</td>
                        <td>80</td>
                    </tr>
                    <tr>
                        <td>Selling Fan</td>
                        <td>00:1B:44:11:3A:B2</td>
                        <td>127.0.0.5</td>
                        <td>2021-05-31</td>
                        <td>100</td>
                    </tr>
                    <tr id="totalRow"> 
                        <td>Total</td>
                        <td></td>
                        <td></td>
                        <td></td>   
                        <td><p id="total">290</p></td>
                    </tr>
                </table>
            </div>
    
            <div class="chartAdd">
                <div class="chart">
                    <div class="chart-container">
                        <p style="text-align: center;">Power Consumption</p>
                        <canvas id="myChart" class="chartpie"></canvas>
                    </div>
                </div>
                <div class="addDevice">
                    <div class="space"></div>
                    <input type="text" name="device" id="device" placeholder="name" required>
                    <input type="text" name="IP" id="ip" placeholder="IP" required>
                    <button type="button" onclick="addDevice()">ADD DEVICE</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script>

function createChart(){
        var table = document.getElementById("viewDevice");
        var rows = table.getElementsByTagName('tr');
        var data = [];
        for(let i = 1; i < rows.length-1;i++){
            const cells = rows[i].getElementsByTagName('td');
            const label = cells[0].innerText;
            const value = parseInt(cells[4].innerText);
            data.push({
                label, value
            });
        }
        const ctx = document.getElementById('myChart').getContext('2d');
        const labels = data.map(item => item.label);
        const values = data.map(item => item.value);
        const myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    label: 'kW/h',
                    data: values,
                    backgroundColor: [
                        'rgb(75,192,192)',
                        'rgb(255, 99, 132)',
                        'rgb(54, 162, 235)',
                        'rgb(255, 205, 86)'
                    ],
                }]
            },
            options: {
                hoverOffset: 4
            }
        });
    }
    document.addEventListener("DOMContentLoaded", function() {
        createChart();
}   );

    var total = 290;

    function addDevice(){
        var deviceInput = document.getElementById("device").value;
        var ipInput = document.getElementById("ip").value;
        if(deviceInput==="" || ipInput===""){
            alert("Nhập đầu đủ thông tin!")
        }
        else
        {
            var table = document.getElementById("viewDevice");
            var row = table.insertRow(1);
            var deviceCell = row.insertCell(0);
            var addressCell = row.insertCell(1);
            var ipCell = row.insertCell(2);
            var dateCell = row.insertCell(3);
            var comCell = row.insertCell(4);

            var devices = ['TV', 'Washer', 'Refrigerator', 'Selling Fan'];
            var address = '8c:ec:4b:74:4a:fb';
            var currentDate = new Date();
            var day = String(currentDate.getDate()).padStart(2,'0');
            var month = String(currentDate.getMonth()+1).padStart(2,'0');
            var year = currentDate.getFullYear();
            var date = year+'-'+month+'-'+day;
            var consumption;
            if(deviceInput == devices[0]) {consumption= 50;}
            else if(deviceInput == devices[1]) {consumption= 60;}
            else if(deviceInput == devices[2]) {consumption= 80;}
            else consumption = 100;
            
            deviceCell.innerHTML = deviceInput;
            addressCell.innerHTML = address;
            ipCell.innerHTML = ipInput;
            dateCell.innerHTML = date;
            comCell.innerHTML = consumption;
            
            total += consumption;
            document.getElementById('total').textContent = total;
            }  
    }
</script>